# üìä API –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## –û–±–∑–æ—Ä

API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –∫–ª–∏–∫–∞–º, –æ—Ñ—Ñ–µ—Ä–∞–º, –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏.

## Endpoints

### 1. –î–∞—à–±–æ—Ä–¥ (–û–±—â–∞—è —Å–≤–æ–¥–∫–∞)

```
GET /api/statistics/dashboard/?days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) - –ø–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "period_days": 30,
    "total_clicks": 1523,
    "unique_users": 342,
    "active_offers": 15,
    "total_offers": 20,
    "subscribers": {
      "total": 500,
      "active": 450,
      "with_messages": 320,
      "by_brand": [...]
    },
    "top_offers": [...],
    "conversion": {
      "total_clicks": 1523,
      "unique_users": 342,
      "conversion_rate": 445.32,
      "avg_clicks_per_user": 4.45
    }
  }
}
```

### 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ñ—Ñ–µ—Ä–∞–º

```
GET /api/statistics/offers/?days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) - –ø–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "offer__id": "offer-123",
      "offer__partner_name": "–ú–ö–ö –ë—ã—Å—Ç—Ä–æ–∑–∞–π–º",
      "offer__logo_url": "https://...",
      "total_clicks": 234,
      "unique_users": 156
    },
    ...
  ]
}
```

### 3. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ñ—Ñ–µ—Ä—É

```
GET /api/statistics/offers/<offer_id>/?days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `offer_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –æ—Ñ—Ñ–µ—Ä–∞
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) - –ø–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "total_clicks": 234,
    "unique_users": 156,
    "avg_clicks_per_user": 1.5,
    "daily": [
      {
        "date": "2025-10-20",
        "clicks": 45
      },
      ...
    ],
    "by_brand": [
      {
        "brand": "kokos",
        "clicks": 120
      },
      ...
    ]
  }
}
```

### 4. –¢–û–ü –æ—Ñ—Ñ–µ—Ä–æ–≤

```
GET /api/statistics/top-offers/?limit=10&days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ñ—Ñ–µ—Ä–æ–≤
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) - –ø–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "offer__id": "offer-123",
      "offer__partner_name": "–ú–ö–ö –ë—ã—Å—Ç—Ä–æ–∑–∞–π–º",
      "offer__logo_url": "https://...",
      "offer__rate_text": "–æ—Ç 0%",
      "total_clicks": 234,
      "unique_users": 156
    },
    ...
  ]
}
```

### 5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º

```
GET /api/statistics/brands/?days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) - –ø–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "brand": "kokos",
      "total_clicks": 523,
      "unique_users": 234
    },
    ...
  ]
}
```

### 6. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º

```
GET /api/statistics/daily/?days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) - –ø–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "date": "2025-10-20",
      "total_clicks": 67,
      "unique_users": 45
    },
    ...
  ]
}
```

### 7. –ö–æ–Ω–≤–µ—Ä—Å–∏—è

```
GET /api/statistics/conversion/?days=30
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `days` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30) - –ø–µ—Ä–∏–æ–¥ –≤ –¥–Ω—è—Ö

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "total_clicks": 1523,
    "unique_users": 342,
    "conversion_rate": 445.32,
    "avg_clicks_per_user": 4.45
  }
}
```

### 8. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º

```
GET /api/statistics/subscribers/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "total": 500,
    "active": 450,
    "with_messages": 320,
    "by_brand": [
      {
        "brand": "kokos",
        "total": 250,
        "active": 230,
        "with_messages": 180
      },
      ...
    ]
  }
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∞–¥–º–∏–Ω–∫–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ñ—Ñ–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É Django: `http://localhost:8000/admin/`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–û—Ñ—Ñ–µ—Ä—ã"
3. –í —Å–ø–∏—Å–∫–µ –æ—Ñ—Ñ–µ—Ä–æ–≤ –Ω–∞–π–¥–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ –æ—Ñ—Ñ–µ—Ä–∞
5. –û—Ç–∫—Ä–æ–µ—Ç—Å—è JSON —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –∑–∞ 7 –¥–Ω–µ–π
curl "http://localhost:8000/api/statistics/dashboard/?days=7"

# –ü–æ–ª—É—á–∏—Ç—å –¢–û–ü-5 –æ—Ñ—Ñ–µ—Ä–æ–≤
curl "http://localhost:8000/api/statistics/top-offers/?limit=5&days=30"

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ—Ñ—Ñ–µ—Ä–∞
curl "http://localhost:8000/api/statistics/offers/offer-123/?days=30"
```

## –ú–µ—Ç—Ä–∏–∫–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

- **total_clicks** - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤
- **unique_users** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **conversion_rate** - –∫–æ–Ω–≤–µ—Ä—Å–∏—è (–∫–ª–∏–∫–∏ / —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ * 100)
- **avg_clicks_per_user** - —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

- **–ü–æ –æ—Ñ—Ñ–µ—Ä–∞–º** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –æ—Ñ—Ñ–µ—Ä—É
- **–ü–æ –±—Ä–µ–Ω–¥–∞–º** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º—É–ª—å—Ç–∏–±—Ä–µ–Ω–¥–∏–Ω–≥)
- **–ü–æ –¥–Ω—è–º** - –¥–∏–Ω–∞–º–∏–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –¥–Ω—è–º
- **–ü–æ —á–∞—Å–∞–º** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∞—Å–∞–º (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∏–∫–æ–≤—ã—Ö –≤—Ä–µ–º—ë–Ω)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python

```python
import requests

# –ü–æ–ª—É—á–∏—Ç—å –¥–∞—à–±–æ—Ä–¥
response = requests.get('http://localhost:8000/api/statistics/dashboard/?days=30')
data = response.json()

print(f"–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤: {data['data']['total_clicks']}")
print(f"–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {data['data']['unique_users']}")
print(f"–ö–æ–Ω–≤–µ—Ä—Å–∏—è: {data['data']['conversion']['conversion_rate']}%")
```

### JavaScript

```javascript
// –ü–æ–ª—É—á–∏—Ç—å –¢–û–ü –æ—Ñ—Ñ–µ—Ä–æ–≤
fetch('/api/statistics/top-offers/?limit=5&days=7')
  .then(response => response.json())
  .then(data => {
    console.log('–¢–û–ü-5 –æ—Ñ—Ñ–µ—Ä–æ–≤:', data.data);
    data.data.forEach(offer => {
      console.log(`${offer.offer__partner_name}: ${offer.total_clicks} –∫–ª–∏–∫–æ–≤`);
    });
  });
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)
2. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ (–ø–∞—Ä–∞–º–µ—Ç—Ä `days`)
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
4. –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ –ë–î –Ω–∞ –ø–æ–ª—è `created_at`, `vk_user_id`, `offer_id`

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV/Excel
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤
- [ ] –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤
- [ ] –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- [ ] –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–æ–≤

